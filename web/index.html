<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Week 2 GPT Chatbot</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 18px auto; }
    #chat { border: 1px solid #ddd; padding: 12px; height: 420px; overflow-y: auto; white-space: pre-wrap; }
    .row { margin: 10px 0; }
    input, button { padding: 10px; font-size: 14px; }
    input { width: 72%; }
    button { width: 24%; }
    small { color: #666; }
  </style>
</head>
<body>
  <h2>Production-Grade GPT Chatbot (Mock Mode)</h2>
  <div class="row">
    <small>Conversation ID:</small>
    <input id="cid" value="demo" />
  </div>
  <div id="chat"></div>

  <div class="row">
    <input id="msg" placeholder="Type a message..." />
    <button id="send">Send</button>
  </div>

  <script>
    const chatEl = document.getElementById("chat");
    const cidEl = document.getElementById("cid");
    const msgEl = document.getElementById("msg");
    const sendBtn = document.getElementById("send");

    function append(text) {
      chatEl.textContent += text;
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    async function send() {
      const cid = cidEl.value.trim() || "demo";
      const user_message = msgEl.value.trim();
      if (!user_message) return;

      append(`\n\nYou: ${user_message}\nBot: `);
      msgEl.value = "";

      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ conversation_id: cid, user_message })
      });

      if (!res.ok) {
        append(`\n[HTTP ${res.status}]`);
        return;
      }

      const reader = res.body.getReader();
      const decoder = new TextDecoder();

      while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        append(decoder.decode(value, { stream: true }));
      }
    }

    sendBtn.addEventListener("click", send);
    msgEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") send();
    });
  </script>
</body>
</html>
